<!DOCTYPE html>
<html>

<head>
  <title>Tic Tac Toe</title>
  <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable='no'">
  <link href="../../css/bootstrap@5.1.3.min.css" rel="stylesheet">
  <link href="../../css/awesome.css" rel="stylesheet">
  <link href="../../css/animate.css" rel="stylesheet">
  <script src="../../js/bootstrap@5.1.3.js"></script>

  <script type="text/javascript" src="../js/easy.js"></script>
  <link href="../css/game-menu.css" rel="stylesheet">
  <script type="text/javascript" src="../js/game-menu.js"></script>
  <link href="../../css/icons.css" rel="stylesheet">

  <style>
    body {
      overflow: hidden;

      * {
        padding: 0px !important;
        margin: 0px !important;
      }

    }
  </style>
  <script>
    let windowWidth = window.innerWidth;
    let windowHeight = window.innerHeight;
    window.onload = function () {
      
      let canvas = new createCanvas(windowWidth, windowHeight, "background: #1b2838;");

      let gameMenu = createGameMenu(windowWidth,windowHeight);

      setPreloadsGame();

      let check = [];
      let flag = true;
      
      let turn = false, game=true;
      let cntXO = 0;
      let PlayerOneWins = 0, PlayerTwoWins = 0;
      let xwins=false,owins=false,drawwins=false;

      let verticalLines = [];
      let horizontalLines = [];
      for (let i = 1; i < 3; i++) {
        verticalLines.push(
          new Line(
            i * (windowWidth / 3),
            windowHeight * 0.5 - windowWidth * 0.5,
            i * (windowWidth / 3),
            windowHeight * 0.5 + windowWidth * 0.5,
            "#6b7986")
        );
        horizontalLines.push(
          new Line(
            0,
            windowHeight * 0.5 - i * (windowWidth / 3) + (windowWidth * 0.5),
            windowHeight * 0.5 + windowWidth * 0.5,
            windowHeight * 0.5 - i * (windowWidth / 3) + (windowWidth * 0.5),
            "#6b7986")
        );
      }

      let tictactoeBoxes = [];
      resetGame();
      
      canvas.drawCanvas();

      canvas.draw();

      canvas.animate(() => {
        let shapesBoard = [
                    [...gameMenu].flat(),
                    [...tictactoeBoxes].flat(),
                    [...verticalLines],
                    [...horizontalLines]
                  ].flat();

        canvas.setShapes(shapesBoard);
      });

      
      canvas.getCanvas().addEventListener('touchstart', function (e) {
        ex = e.touches[0].clientX;
        ey = e.touches[0].clientY;

        if(game){
          // console.log("abc");
          tictactoeBoxes.forEach((line,i)=>{
            line.forEach((item,j)=>{
              // console.log(item);
              if (item.x < ex && (item.x + item.width) > ex && item.y < ey && (item.y + item.height) > ey) {
                // console.log("a");
                if(item.img.src.includes("Blank-min")) {
                  if (turn) {
                    turn = !turn;
                    item.img.src = "images/O-min.png";
                    check[i][j] = "O";
                    cntXO++;
                    // console.log("b");
                  }
                  else if (!turn) {
                    turn = !turn;
                    item.img.src = "images/X-min.png";
                    check[i][j] = "X";
                    cntXO++;
                    // console.log("c");
                  }
                }
              }
            })
          });
          // console.log(cntXO);
          checkWin(cntXO);
        }
      });

      function resetGame() {
        tictactoeBoxes = [];
        check = [];
        // console.log(t);
        for (let i = 1; i <= 3; i++) {
          let tictactoeBox = [];
          let c = [];
          for (let j = 0; j < 3; j++) {
            tictactoeBox.push(
              new SpriteImage(
                "images/Blank-min.png",
                j * (windowWidth / 3),
                (((i * (windowWidth / 3)) + (windowHeight * 0.5)) - (windowWidth / 3)) - (windowWidth / 2),
                (windowWidth / 3),
                (windowWidth / 3)
              )
            );
            c.push(null);
          }
          check.push(c);
          tictactoeBoxes.push(tictactoeBox);
        }

        game = true;
        cntXO = 0;
        xwins=false;
        owins=false;
        drawwins=false;
      }

      function checkWin(cnt) {
        let s = check.flat();
        // console.log(s);
        let win = [[0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 4, 8], [2, 4, 6]];
        for(var i=0;i<win.length;i++){
          if(game){
            if(s[win[i][0]]=="X" && s[win[i][1]]=="X" && s[win[i][2]]=="X"){
              alert("Player 1 Won");
              PlayerOneWins++;
              document.querySelector("#PlayerOneWins").innerHTML = PlayerOneWins;
              game = false;
              resetGame();
              break;
            }
            else if(s[win[i][0]]=="O" && s[win[i][1]]=="O" && s[win[i][2]]=="O"){
              alert("Player 2 Won");
              PlayerTwoWins++;
              document.querySelector("#PlayerTwoWins").innerHTML = PlayerTwoWins;
              game = false;
              resetGame();
              break;
            }
          }
        }
        
        if(cnt>=9 && game){
            alert("Draw");
            resetGame();
            // game = false;
        }
      }

      function checkseq(a, b, c, d) {
        let ck = check.flat();
        let seq = (ck[a] == d && ck[b] == d && ck[c] == d);
        return seq;
      }
    }

    function setPreloadsGame() {
      let playerOneFaceButtonHTML = document.getElementById('playerface1');
      playerOneFaceButtonHTML.style.background = 'url("../../images/players-icons/P1.png") 50% 50% / cover no-repeat';

      let playerTwoFaceButtonHTML = document.getElementById('playerface2');
      playerTwoFaceButtonHTML.style.background = 'url("../../images/players-icons/P4.png") 50% 50% / cover no-repeat';

      let playerOneNameButtonHTML = document.getElementById('playerOneName');
      playerOneNameButtonHTML.innerHTML = "Player 1 III<br>00 : 00";

      let playerTwoNameButtonHTML = document.getElementById('playerTwoName');
      playerTwoNameButtonHTML.innerHTML = "III Player 2<br>00 : 00";

      let playerOneScoreImageButtonHTML = document.getElementById('playerOneScoreImage');
      playerOneScoreImageButtonHTML.src = "images/X-min.png";

      let playerTwoScoreImageButtonHTML = document.getElementById('playerTwoScoreImage');
      playerTwoScoreImageButtonHTML.src = "images/O-min.png";

      let playerOneScoreButtonHTML = document.getElementById('PlayerOneWins');
      playerOneScoreButtonHTML.innerHTML = "0";

      let playerTwoScoreButtonHTML = document.getElementById('PlayerTwoWins');
      playerTwoScoreButtonHTML.innerHTML = "0";

      let aboutGameButtonHTML = document.getElementById('aboutGame');
      aboutGameButtonHTML.innerHTML = "About Game";
      aboutGameButtonHTML.setAttribute('data-bs-toggle' ,"modal");
      aboutGameButtonHTML.setAttribute('data-bs-target' , "#main-modal");
      aboutGameButtonHTML.addEventListener('click',()=>{
          document.querySelector(".modal-body").innerHTML = `
            <h4>*Game Rules*</h4>
            <p class="text-center">
              Tic-Tac-Toe is a classic game played on a 3x3 grid.
              <br>The rules are simple:
              <br><br>
            </p>
            <p class="text-left" style="text-align:left;">
              1. Two players take turns marking spaces in the grid with either an "X" or an "O".<br><br>
              2. The first player to get three of their marks in a row (horizontally, vertically, or diagonally) wins.<br><br>
              3. If all spaces are filled without any player achieving three in a row, the game is a draw.<br><br>
              4. Players cannot mark a space that is already occupied.<br><br><br>
            </p>
            <p class="text-center">That's pretty much it! It's a game of strategy and quick thinking.</p>
          `;
          
          let modalContent = document.querySelector('.modal-content');
          modalContent.style.cssText = setbound(windowWidth*0.05, windowHeight*0.05, windowWidth*0.90 , windowHeight*0.90);
          
      });	

      let settingSectionButtonHTML = document.getElementById('gamesettings');
      settingSectionButtonHTML.innerHTML = "";
      settingSectionButtonHTML.style.background = 'url("../images/game-menu-svg/settings.svg") 50% 50% / 50% no-repeat';
      settingSectionButtonHTML.setAttribute('data-bs-toggle' ,"modal");
      settingSectionButtonHTML.setAttribute('data-bs-target' , "#main-modal");
      settingSectionButtonHTML.addEventListener('click',()=>{
          document.querySelector(".modal-body").innerHTML = `
            <h4>Settings</h4>
            <p class="text-center"><table>
                <tbody>
                  <tr>
                    <td>Sound</td>
                    <td>
                      <img class="sound" src="../images/game-menu-svg/volume-mute-outline.svg">
                    </td>
                  </tr>  
                  <tr>
                    <td>Music</td>
                    <td>
                      <img class="music" src="../images/game-menu-svg/volume-high-outline.svg">
                    </td>
                  </tr>
                  <tr>
                    <td>Language</td>
                    <td>
                      <select>
                        <option>English</option>
                      </select>
                    </td>
                  </tr>  
                  <tr>
                    <td>Theme</td>
                    <td>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" checked>
                      </div>
                    </td>
                  </tr>  
                </tbody>  
              </table>
            </p>
          `;
          
          let modalContent = document.querySelector('.modal-content');
          modalContent.style.cssText = setbound(windowWidth*0.05, windowHeight*0.15, windowWidth*0.90 , windowHeight*0.70);
      });	

      let menuIconSectionButtonHTML = document.getElementById('gamemenu');
      menuIconSectionButtonHTML.innerHTML = "";
      menuIconSectionButtonHTML.style.background = 'url("../images/game-menu-svg/exit-outline.svg") 50% 50% / 50% no-repeat';
      menuIconSectionButtonHTML.addEventListener('click',()=>{
          alert("Exit game functionality");
      });	
    }
  </script>
</head>

<body>
  <div class="container"></div>
</div>
</body>

</html>
