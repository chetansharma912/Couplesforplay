<!DOCTYPE html>
<html>

<head>
  <title>Tic Tac Toe</title>
  <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable='no'">
  <link href="../../css/bootstrap@5.1.3.min.css" rel="stylesheet">
  <link href="../../css/awesome.css" rel="stylesheet">
  <link href="../../css/animate.css" rel="stylesheet">
  <script src="../../js/bootstrap@5.1.3.js"></script>

  <script type="text/javascript" src="../../js/easy.js"></script>
  <style>
    body {
      overflow: hidden;

      * {
        padding: 0px !important;
        margin: 0px !important;
      }
    }
  </style>
  <script>
    window.onload = function () {
      let windowWidth = window.innerWidth;
      let windowHeight = window.innerHeight;

      let canvas = new createCanvas(windowWidth, windowHeight, "background: black;");

      // middle box
      let menuRect = new Rectangle(0, 0, windowWidth , windowHeight*0.1, "black", "#f0d9b5");
      let bottomMenuRect = new Rectangle(0, windowHeight*0.9, windowWidth , windowHeight*0.1, "black", "#f0d9b5");
      
      // players 1

      let check = [];
      let flag = true; let cnt=0;
      let xpoints=0,opoints=0,draw=0;

      let verticalLines = [];
      let horizontalLines = [];
      for (let i = 1; i < 3; i++) {
        verticalLines.push(
          new Line(
            i * (windowWidth / 3),
            windowHeight * 0.5 - windowWidth * 0.5,
            i * (windowWidth / 3),
            windowHeight * 0.5 + windowWidth * 0.5,
            "white")
        );
        horizontalLines.push(
          new Line(
            0,
            windowHeight * 0.5 - i * (windowWidth / 3) + (windowWidth * 0.5),
            windowHeight * 0.5 + windowWidth * 0.5,
            windowHeight * 0.5 - i * (windowWidth / 3) + (windowWidth * 0.5),
            "white")
        );
      }

      let tictactoeBoxes = [];
      for(let i=1;i<=3;i++){
        let tictactoeBox = [];
        let c =[];
        for(let j=0;j<3;j++){
          tictactoeBox.push(
            new SpriteImage(
              "images/game1.png",
              j * (windowWidth / 3),
              windowHeight * 0.2 + (i * (windowWidth / 3)) - ((windowWidth / 3)/2)-15,
              (windowWidth / 3),
              (windowWidth / 3)
            )
          );
          c.push(null);
        }
        check.push(c);
        tictactoeBoxes.push(tictactoeBox);
      }

      // console.log(tictactoeBoxes,check);
      
      canvas.drawCanvas();

      let shapesBoard = [
                    menuRect,
                    [...tictactoeBoxes].flat(),
                    [...verticalLines],
                    [...horizontalLines],
                    
                    bottomMenuRect
                  ].flat();

      canvas.setShapes(shapesBoard);

      canvas.draw();

      canvas.animate(() => {
        
      });

      let turn = true, game=true;;
      let cntXO = 0;
      canvas.getCanvas().addEventListener('touchstart', function (e) {
        ex = e.touches[0].clientX;
        ey = e.touches[0].clientY;

        if(game){
          // console.log("abc");
          tictactoeBoxes.forEach((line,i)=>{
            line.forEach((item,j)=>{
              // console.log(item);
              if (item.x < ex && (item.x + item.width) > ex && item.y < ey && (item.y + item.height) > ey) {
                if (turn) {
                  turn = !turn;
                  item.img.src = "images/White.png";
                  check[i][j] = "O";
                  cntXO++;
                }
                else if (!turn) {
                  turn = !turn;
                  item.img.src = "images/Red.png";
                  check[i][j] = "X";
                  cntXO++;
                }
              }
            })
          });

          checkWin(cntXO);
        }
      });


      function checkWin(cnt) {
        let s = check.flat();
        // console.log(s);
        let wins = [[0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 4, 8], [2, 4, 6]];
        wins.forEach((win) => {
          if(s[win[0]]=="O" && s[win[1]]=="O" && s[win[2]]=="O"){
            console.log("O Won");
            game = false;
          }
          else if(s[win[0]]=="X" && s[win[1]]=="X" && s[win[2]]=="X"){
            console.log("X Won");
            game = false;
          }
          else {
            if(cnt>8){
              console.log("Draw");
              game = false;
            }
          }
        });
      }

      function checkseq(a, b, c, d) {
        let ck = check.flat();
        let seq = (ck[a] == d && ck[b] == d && ck[c] == d);
        return seq;
      }
    }
  </script>
</head>

<body>
  <div class="container"></div>
</body>

</html>
