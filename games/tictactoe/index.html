<!DOCTYPE html>
<html>

<head>
  <title>Tic Tac Toe</title>
  <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable='no'">
  <link href="../../css/bootstrap@5.1.3.min.css" rel="stylesheet">
  <link href="../../css/awesome.css" rel="stylesheet">
  <link href="../../css/animate.css" rel="stylesheet">
  <script src="../../js/bootstrap@5.1.3.js"></script>

  <script type="text/javascript" src="../../js/easy.js"></script>
  <style>
    body {
      overflow: hidden;

      * {
        padding: 0px !important;
        margin: 0px !important;
      }
    }
  </style>
  <script>
    window.onload = function () {
      let windowWidth = window.innerWidth;
      let windowHeight = window.innerHeight;

      let canvas = new createCanvas(windowWidth, windowHeight, "background: #1b2838;");

      let gameMenu = canvas.createGameMenu(windowWidth, windowHeight);

      let check = [];
      let flag = true;
      
      let turn = false, game=true;
      let cntXO = 0;
      let PlayerOneWins = 0, PlayerTwoWins = 0;

      let verticalLines = [];
      let horizontalLines = [];
      for (let i = 1; i < 3; i++) {
        verticalLines.push(
          new Line(
            i * (windowWidth / 3),
            windowHeight * 0.5 - windowWidth * 0.5,
            i * (windowWidth / 3),
            windowHeight * 0.5 + windowWidth * 0.5,
            "#6b7986")
        );
        horizontalLines.push(
          new Line(
            0,
            windowHeight * 0.5 - i * (windowWidth / 3) + (windowWidth * 0.5),
            windowHeight * 0.5 + windowWidth * 0.5,
            windowHeight * 0.5 - i * (windowWidth / 3) + (windowWidth * 0.5),
            "#6b7986")
        );
      }

      let tictactoeBoxes = [];
      resetGame();
      
      canvas.drawCanvas();

      canvas.draw();

      canvas.animate(() => {
        let shapesBoard = [
                    [...gameMenu].flat(),
                    [...tictactoeBoxes].flat(),
                    [...verticalLines],
                    [...horizontalLines]
                  ].flat();

        canvas.setShapes(shapesBoard);
      });

      
      canvas.getCanvas().addEventListener('touchstart', function (e) {
        ex = e.touches[0].clientX;
        ey = e.touches[0].clientY;

        if(game){
          // console.log("abc");
          tictactoeBoxes.forEach((line,i)=>{
            line.forEach((item,j)=>{
              // console.log(item);
              if (item.x < ex && (item.x + item.width) > ex && item.y < ey && (item.y + item.height) > ey) {
                // console.log("a");
                if(item.img.src.includes("Blank")) {
                  if (turn) {
                    turn = !turn;
                    item.img.src = "images/O-min.png";
                    check[i][j] = "O";
                    cntXO++;
                    // console.log("b");
                  }
                  else if (!turn) {
                    turn = !turn;
                    item.img.src = "images/X-min.png";
                    check[i][j] = "X";
                    cntXO++;
                    // console.log("c");
                  }
                }
              }
            })
          });
          // console.log(cntXO);
          checkWin(cntXO);
        }
      });

      function resetGame() {
        tictactoeBoxes = [];
        check = [];
        // console.log(t);
        for (let i = 1; i <= 3; i++) {
          let tictactoeBox = [];
          let c = [];
          for (let j = 0; j < 3; j++) {
            tictactoeBox.push(
              new SpriteImage(
                "images/Blank-min.png",
                j * (windowWidth / 3),
                (((i * (windowWidth / 3)) + (windowHeight * 0.5)) - (windowWidth / 3)) - (windowWidth / 2),
                (windowWidth / 3),
                (windowWidth / 3)
              )
            );
            c.push(null);
          }
          check.push(c);
          tictactoeBoxes.push(tictactoeBox);
        }

        game = true;
        cntXO = 0;
      }

      function checkWin(cnt) {
        let s = check.flat();
        // console.log(s);
        let wins = [[0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 4, 8], [2, 4, 6]];
        wins.forEach((win) => {
          if(s[win[0]]=="X" && s[win[1]]=="X" && s[win[2]]=="X"){
            alert("X Won");
            PlayerOneWins++;
            document.querySelector("#PlayerOneWins").innerHTML = PlayerOneWins;
            // game = false;
            resetGame();
          }
          else if(s[win[0]]=="O" && s[win[1]]=="O" && s[win[2]]=="O"){
            alert("O Won");
            PlayerTwoWins++;
            document.querySelector("#PlayerTwoWins").innerHTML = PlayerTwoWins;
            // game = false;
            resetGame();
          }
        });

        if(cnt>=9 && game){
          alert("Draw");
          resetGame();
          // game = false;
        }
      }

      function checkseq(a, b, c, d) {
        let ck = check.flat();
        let seq = (ck[a] == d && ck[b] == d && ck[c] == d);
        return seq;
      }
    }
  </script>
</head>

<body>
  <div class="container"></div>
</body>

</html>
